{"is_source_file": true, "format": "JavaScript", "description": "This file defines Express.js route handlers for managing lessons in an online learning platform. It includes CRUD operations, AI content generation, video upload URL generation, and viewing URLs, with extensive validation and integrated middleware for authentication and authorization.", "external_files": ["../middleware/auth", "../middleware/rbac", "../config/db", "../services/ai", "../services/storage"], "external_methods": ["auth", "rbac", "getDataSource", "createAIService", "getUploadPresignedUrl", "getPresignedUrl"], "published": ["router"], "classes": [], "methods": [{"name": "normalizeStoredQuiz(raw)", "description": "Normalizes quiz data stored in the database, handling null, JSON string, or array formats.", "scope": "", "scopeKind": ""}, {"name": "computeQuizScore(quiz, answers)", "description": "Calculates the number of correct answers and percentage score for a given quiz and answers.", "scope": "", "scopeKind": ""}, {"name": "isValidId(raw)", "description": "Checks if a given raw value is a valid positive integer ID.", "scope": "", "scopeKind": ""}, {"name": "normalizeString(value)", "description": "Trims and normalizes string input, returning empty string if whitespace only.", "scope": "", "scopeKind": ""}, {"name": "toLessonResponse(lesson)", "description": "Converts lesson entity to a sanitized API response object.", "scope": "", "scopeKind": ""}, {"name": "validateCreatePayload(body)", "description": "Validates and sanitizes the payload for creating a lesson.", "scope": "", "scopeKind": ""}, {"name": "validateUpdatePayload(body)", "description": "Validates and prepares payload for updating a lesson, supporting partial updates.", "scope": "", "scopeKind": ""}, {"name": "parseListQueryParams(query)", "description": "Parses query parameters for listing lessons (pagination, filtering, sorting).", "scope": "", "scopeKind": ""}], "calls": ["getDataSource()", "createAIService()", "getUploadPresignedUrl()", "getPresignedUrl()"], "search-terms": ["lessons.js", "Express routes", "lesson management", "AI content generation", "video upload URL", "presigned URL", "lesson CRUD", "middleware/auth", "middleware/rbac"], "state": 2, "file_id": 20, "knowledge_revision": 147, "git_revision": "4cd6ac3e790150b91faf6afc529f9c48e0d66c83", "revision_history": [{"59": "fdfbc0c8211f970237ecb8a46f574b6d9e6f02f5"}, {"80": "ac0f6efe3cff082774d90dbbaa94ede573f6657f"}, {"90": "ac0f6efe3cff082774d90dbbaa94ede573f6657f"}, {"91": "ac0f6efe3cff082774d90dbbaa94ede573f6657f"}, {"92": "ac0f6efe3cff082774d90dbbaa94ede573f6657f"}, {"93": "ac0f6efe3cff082774d90dbbaa94ede573f6657f"}, {"94": "ac0f6efe3cff082774d90dbbaa94ede573f6657f"}, {"95": "ac0f6efe3cff082774d90dbbaa94ede573f6657f"}, {"113": "f8f2b7e466e6fafdadf3402bffcd187eca5db108"}, {"118": "f8f2b7e466e6fafdadf3402bffcd187eca5db108"}, {"124": "2ad351f398082359982a5fee492703cda513fed8"}, {"132": "7c132f2ba0cbfa921f47c07d4be8fedc5411604f"}, {"143": "3db7263670f21a9dca189aea6f523ca103b1eeee"}, {"147": "4cd6ac3e790150b91faf6afc529f9c48e0d66c83"}], "ctags": [{"_type": "tag", "name": "ALLOWED_LESSON_STATUSES", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^const ALLOWED_LESSON_STATUSES = ['draft', 'published', 'archived'];$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "SORT_FIELDS", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^const SORT_FIELDS = ['createdAt', 'updatedAt', 'title', 'order'];$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "SORT_ORDERS", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^const SORT_ORDERS = ['ASC', 'DESC'];$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "WRITE_ROLES", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^const WRITE_ROLES = ['admin', 'instructor'];$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "auth", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^const auth = require('..\\/middleware\\/auth');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "computeQuizScore", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^function computeQuizScore(quiz, answers) {$/", "language": "JavaScript", "kind": "function", "signature": "(quiz, answers)"}, {"_type": "tag", "name": "express", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^const express = require('express');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "isValidId", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^function isValidId(raw) {$/", "language": "JavaScript", "kind": "function", "signature": "(raw)"}, {"_type": "tag", "name": "normalizeStoredQuiz", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^function normalizeStoredQuiz(raw) {$/", "language": "JavaScript", "kind": "function", "signature": "(raw)"}, {"_type": "tag", "name": "normalizeString", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^function normalizeString(value) {$/", "language": "JavaScript", "kind": "function", "signature": "(value)"}, {"_type": "tag", "name": "parseListQueryParams", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^function parseListQueryParams(query) {$/", "language": "JavaScript", "kind": "function", "signature": "(query)"}, {"_type": "tag", "name": "rbac", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^const rbac = require('..\\/middleware\\/rbac');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^const router = express.Router();$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "toLessonResponse", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^function toLessonResponse(lesson) {$/", "language": "JavaScript", "kind": "function", "signature": "(lesson)"}, {"_type": "tag", "name": "validateCreatePayload", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^function validateCreatePayload(body) {$/", "language": "JavaScript", "kind": "function", "signature": "(body)"}, {"_type": "tag", "name": "validateUpdatePayload", "path": "/home/kavia/workspace/code-generation/digitalt3-learning-insights-platform-311763-311772/lms_backend/src/routes/lessons.js", "pattern": "/^function validateUpdatePayload(body) {$/", "language": "JavaScript", "kind": "function", "signature": "(body)"}], "hash": "c0967473ec7d39952b7da0f444bbb488", "format-version": 4, "code-base-name": "lms_backend", "filename": "lms_backend/src/routes/lessons.js"}